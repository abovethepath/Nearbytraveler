Got it — you don’t want the CTA to “auto-login demo user.” You want it to open a Welcome Back / Sign in page where the user can enter credentials, and only then start a session.

Here’s the clean way to wire it:

What to change (summary)

Keep your CTA linking to the client route: /signin (not /api/login).

Stop auto-login (your current GET /api/login) — keep it as a hidden Demo button only.

Add a real login endpoint POST /api/auth/login that takes email/password, sets the session, and returns JSON.

Build a WelcomeBack page at /signin with a form that calls POST /api/auth/login.

Keep the existing GET /api/auth/user and the new POST /api/auth/logout.

Server (Express + sessions)
1) Real login endpoint (email + password)
// server/routes.ts
import bcrypt from "bcrypt";

app.post("/api/auth/login", async (req, res) => {
  try {
    const { email, password } = req.body || {};
    if (!email || !password) {
      return res.status(400).json({ message: "Email and password are required" });
    }

    const user = await storage.getUserByEmail?.(email);
    if (!user) return res.status(401).json({ message: "Invalid credentials" });

    // If you don't have hashed passwords yet, do a plain compare temporarily.
    const ok = user.passwordHash
      ? await bcrypt.compare(password, user.passwordHash)
      : password === user.password; // TEMP during dev

    if (!ok) return res.status(401).json({ message: "Invalid credentials" });

    req.session = req.session || {};
    req.session.user = {
      id: user.id,
      username: user.username,
      email: user.email,
      profileImageUrl: user.profileImage,
    };

    req.session.save((err) => {
      if (err) {
        console.error("Session save error:", err);
        return res.status(500).json({ message: "Session error" });
      }
      return res.status(200).json({ ok: true });
    });
  } catch (e) {
    console.error("Login error:", e);
    return res.status(500).json({ message: "Server error" });
  }
});

2) Logout (as we added earlier)
app.post("/api/auth/logout", (req, res) => {
  if (!req.session) return res.status(200).json({ ok: true });
  req.session.destroy((err) => {
    if (err) console.error("Session destroy error:", err);
    res.clearCookie("connect.sid");
    res.status(200).json({ ok: true });
  });
});

3) (Optional) Keep your demo auto-login, but only for a special button
// Dev/Demo-only auto login (hide this from normal users)
app.get("/api/login", async (req, res) => {
  try {
    const user = await storage.getUser("2");
    if (user) {
      req.session = req.session || {};
      req.session.user = {
        id: user.id,
        username: user.username,
        email: user.email,
        profileImageUrl: user.profileImage,
      };
      return req.session.save(() => res.redirect("/"));
    }
    res.redirect("/");
  } catch (e) {
    res.redirect("/");
  }
});


Replit session sanity: if you’re not on HTTPS, set your session cookie to secure: false, sameSite: "lax", and app.set('trust proxy', 1) only if you’re actually behind a proxy.

Client (Wouter + shadcn)
1) CTA on landing
// LandingHero.tsx
import { Link } from "wouter";
import { Button } from "@/components/ui/button";

<Button asChild>
  <Link href="/signin">Sign in</Link>
</Button>

2) WelcomeBack (/signin) page

Shows an email/password form.

On submit → POST /api/auth/login.

On success → navigate to /.

// routes/SignInPage.tsx
import { useState } from "react";
import { useLocation } from "wouter";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";

export default function SignInPage() {
  const [, setLocation] = useLocation();
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [loading, setLoading] = useState(false);
  const [err, setErr] = useState<string | null>(null);

  async function handleLogin(e: React.FormEvent) {
    e.preventDefault();
    setLoading(true);
    setErr(null);
    try {
      const res = await fetch("/api/auth/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        credentials: "include",
        body: JSON.stringify({ email, password }),
      });
      if (!res.ok) {
        const data = await res.json().catch(() => ({}));
        throw new Error(data.message || "Login failed");
      }
      setLocation("/"); // go home (or /welcome)
    } catch (e: any) {
      setErr(e.message || "Login failed");
    } finally {
      setLoading(false);
    }
  }

  return (
    <div className="min-h-[60vh] flex items-center justify-center p-6">
      <Card className="w-full max-w-md">
        <CardHeader>
          <CardTitle>Welcome back</CardTitle>
        </CardHeader>
        <CardContent>
          <form onSubmit={handleLogin} className="space-y-4">
            <div className="space-y-2">
              <label className="text-sm">Email</label>
              <Input
                type="email"
                autoComplete="email"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                required
              />
            </div>
            <div className="space-y-2">
              <label className="text-sm">Password</label>
              <Input
                type="password"
                autoComplete="current-password"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                required
              />
            </div>

            {err && <p className="text-sm text-red-600">{err}</p>}

            <Button type="submit" disabled={loading} className="w-full">
              {loading ? "Signing in..." : "Sign in"}
            </Button>

            {/* Optional: keep a demo button for you only */}
            <Button type="button" variant="outline" className="w-full"
              onClick={() => (window.location.href = "/api/login")}>
              Continue as Demo User
            </Button>
          </form>
        </CardContent>
      </Card>
    </div>
  );
}

3) Routes
// App.tsx (or Routes.tsx)
import { Route } from "wouter";
import SignInPage from "@/routes/SignInPage";

<Route path="/signin" component={SignInPage} />

4) Navbar “Sign out” (unchanged from previous fix)

Calls POST /api/auth/logout then clears client state and navigates.

Why your current behavior happens

Your CTA probably goes to /signin, but your current SignIn page (from earlier) immediately redirected to /api/login in a useEffect. That’s why you never saw the form — it just auto-logged in. Remove that redirect and use the form above.