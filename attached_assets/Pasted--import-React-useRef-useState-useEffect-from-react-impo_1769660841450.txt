  import React, { useRef, useState, useEffect } from 'react';
import { StyleSheet, View, SafeAreaView, StatusBar, ActivityIndicator, BackHandler, Platform } from 'react-native';
import { WebView } from 'react-native-webview';
export default function App() {
  const webViewRef = useRef(null);
  const [isLoading, setIsLoading] = useState(true);
  // Handle Android back button
  useEffect(() => {
    if (Platform.OS === 'android') {
      const backHandler = BackHandler.addEventListener('hardwareBackPress', () => {
        if (webViewRef.current) {
          webViewRef.current.goBack();
          return true;
        }
        return false;
      });
      return () => backHandler.remove();
    }
  }, []);
  // Inject JavaScript to fix touch handling in WebView
  const injectedJavaScript = `
    (function() {
      // Remove touch-action restrictions that break WebView
      const style = document.createElement('style');
      style.textContent = \`
        * {
          -webkit-touch-callout: default !important;
          touch-action: auto !important;
        }
        button, a, [role="button"] {
          cursor: pointer !important;
          touch-action: manipulation !important;
        }
      \`;
      document.head.appendChild(style);
      
      // Signal app is in WebView
      window.isNativeApp = true;
      console.log('Native WebView JavaScript injected');
    })();
    true;
  `;
  return (
    <SafeAreaView style={styles.container}>
      <StatusBar barStyle="dark-content" backgroundColor="#ffffff" />
      <WebView
        ref={webViewRef}
        source={{ uri: 'https://nearbytraveler.org' }}
        style={styles.webview}
        onLoadEnd={() => setIsLoading(false)}
        
        // Core settings
        javaScriptEnabled={true}
        domStorageEnabled={true}
        
        // Touch and gesture settings - CRITICAL for iOS
        allowsBackForwardNavigationGestures={true}
        allowsInlineMediaPlayback={true}
        scrollEnabled={true}
        bounces={true}
        
        // iOS-specific settings
        allowsLinkPreview={false}
        automaticallyAdjustContentInsets={true}
        contentInsetAdjustmentBehavior="automatic"
        
        // Performance and caching
        cacheEnabled={true}
        incognito={false}
        
        // Geolocation
        geolocationEnabled={true}
        
        // Inject JS to fix touch handling
        injectedJavaScript={injectedJavaScript}
        
        // Handle messages from web app if needed
        onMessage={(event) => {
          console.log('Message from web:', event.nativeEvent.data);
        }}
        
        // Better error handling
        onError={(syntheticEvent) => {
          const { nativeEvent } = syntheticEvent;
          console.warn('WebView error:', nativeEvent);
        }}
        
        // User agent to identify app
        applicationNameForUserAgent="NearbyTravelerApp/1.0"
      />
      {isLoading && (
        <View style={styles.loading}>
          <ActivityIndicator size="large" color="#F97316" />
        </View>
      )}
    </SafeAreaView>
  );
}
const styles = StyleSheet.create({
  container: { 
    flex: 1, 
    backgroundColor: '#fff' 
  },
  webview: { 
    flex: 1 
  },
  loading: { 
    position: 'absolute', 
    top: 0, 
    left: 0, 
    right: 0, 
    bottom: 0, 
    justifyContent: 'center', 
    alignItems: 'center', 
    backgroundColor: '#fff' 
  }
});