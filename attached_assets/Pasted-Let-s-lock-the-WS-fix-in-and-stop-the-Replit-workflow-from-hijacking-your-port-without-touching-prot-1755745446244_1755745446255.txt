Letâ€™s lock the WS fix in and stop the Replit workflow from hijacking your portâ€”without touching protected files.

Goal

Run only your one-port Vite+Express dev server on Replit so HMR works (no ERR_CONNECTION_REFUSED), even if the old workflow tries to restart.

Option A â€” â€œSelf-healingâ€ start script (set-and-forget)

This keeps your one-port server alive and kills the rogue workflow whenever it respawns.

Create start-dev.sh at repo root:

#!/usr/bin/env bash
set -euo pipefail

# Use Replit-assigned port if present
PORT="${PORT:-5000}"

echo "ðŸ‘Ÿ Starting guard loop on PORT=$PORT"

while true; do
  # Kill any competing servers/workflows that bind or spawn React/Vite overlays
  pkill -f "server/index|vite-plugin-cartographer|runtime-error-modal" >/dev/null 2>&1 || true

  # If our dev-oneport isnâ€™t running, start it
  if ! pgrep -f "node dev-oneport.mjs" >/dev/null 2>&1; then
    echo "ðŸš€ Launching one-port dev server on $PORT"
    PORT="$PORT" node dev-oneport.mjs >/tmp/dev-oneport.log 2>&1 &
  fi

  # Re-check every 2s; aggressively keeps our server in control
  sleep 2
done


Run it:

chmod +x start-dev.sh
./start-dev.sh


Open the webview. HMR should connect on the same origin/port.

If the old workflow wakes up, this loop kills it and restarts yours.

To stop: pkill -f start-dev.sh && pkill -f dev-oneport.mjs.

Option B â€” Ship mode (no WS) to verify UI immediately

If you just want the site visible now with all your mobile work:

pkill -f node || true
cd client && npx vite build && cd ..
NODE_ENV=production node server/index.prod.js


Serves dist/public on $PORT; no WebSocket needed.

Sanity checks (takes 30 seconds)

Browser DevTools â†’ Network â†’ WS:

Option A: You see a single WS to the same origin/port as the page.

Option B: No WS at all (expected).

Shell:

lsof -i -P -n | grep -E ':5000|:3000|:5173' || true


You should only see your one-port serverâ€™s PID on $PORT (usually 5000 on Replit).

Why this works

We bind dev-oneport to process.env.PORT so Replitâ€™s webview targets the correct origin.

The guard loop prevents the protected workflow from stealing the port again.

No edits to .replit, replit.yaml, or other protected files.

Want me to tailor the guardâ€™s kill patterns to your exact process names? Paste the output of:

ps aux | grep -E "node|vite|cartographer|runtime" | grep -v grep


and Iâ€™ll tighten the script so it only targets the troublemakers.