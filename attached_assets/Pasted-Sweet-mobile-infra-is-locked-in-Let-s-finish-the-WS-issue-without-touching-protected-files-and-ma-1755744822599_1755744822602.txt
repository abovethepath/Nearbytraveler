Sweet — mobile infra is locked in. Let’s finish the WS issue without touching protected files and make it stick on Replit.

Do this once per session (works today)
1) Make the one-port dev server use Replit’s $PORT

Update your dev-oneport.mjs to bind to whatever port Replit assigns (so the IDE webview points at the right origin automatically):

import path from "path";
import express from "express";
import { createServer as createHttpServer } from "http";
import { fileURLToPath } from "url";

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

async function main() {
  const app = express();

  // OPTIONAL: mount your API router here if needed
  // const api = (await import("./server/api.js")).default;
  // app.use("/api", api);

  const { createServer: createViteServer } = await import("vite");
  const vite = await createViteServer({
    root: path.resolve(__dirname, "client"),
    appType: "custom",
    server: { middlewareMode: true }, // HMR rides same origin
  });
  app.use(vite.middlewares);

  const PORT = Number(process.env.PORT) || 5000;
  createHttpServer(app).listen(PORT, "0.0.0.0", () => {
    console.log(`Dev server running on http://0.0.0.0:${PORT} (Vite middleware)`);
  });
}
main().catch((e) => { console.error(e); process.exit(1); });

2) Start your server and kill the old workflow once

In the Replit Shell (don’t press the IDE “Run/Debug” button afterward):

echo "PORT=$PORT"                         # sanity check
pkill -f "server/index|vite-plugin-cartographer|runtime-error-modal" || true
node dev-oneport.mjs


Keep this process in the foreground.

Open the webview → DevTools → Network → WS: you should see a WebSocket connected to the same origin/port as the page (no :3000, no ERR_CONNECTION_REFUSED).

If the IDE tries to auto-restart the original workflow, don’t click its restart banner. Just use the Shell process you started.

If the IDE keeps hijacking the port

Use the “ship mode” fallback to verify UI immediately (no WS needed):

pkill -f node || true
cd client && npx vite build && cd ..
NODE_ENV=production node server/index.js


This serves the built client from dist/public on $PORT. You can still test all your mobile changes.

Quick checklist

dev-oneport.mjs binds to process.env.PORT ✔

You start it from Shell, not the IDE Run/Debug ✔

No other process is listening (kill once with pkill -f "server/index|cartographer|runtime-error") ✔

DevTools → WS shows a single connection to your page’s origin ✔

If you paste the exact Shell output of echo $PORT and any lingering WS error line from the browser console, I’ll tailor the one-liner kill/start command so it always wins on your workspace.