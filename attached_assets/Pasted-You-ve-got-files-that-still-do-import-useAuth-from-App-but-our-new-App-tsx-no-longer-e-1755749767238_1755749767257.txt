You’ve got files that still do:

import { useAuth } from "@/App";


…but our new App.tsx no longer exports that hook. Quickest fix: add a compatible useAuth and re-export it from App.tsx (no other files need to change).

1) Update client/src/auth-context.ts

Add a tiny hook (and an optional provider for tests/standalone usage).

// client/src/auth-context.ts
import React, { createContext, useContext, useState } from "react";

export type AuthUser = { id: number; username?: string | null } | null;

export type AuthContextValue = {
  user: AuthUser;
  setUser: React.Dispatch<React.SetStateAction<AuthUser>>;
};

export const AuthContext = createContext<AuthContextValue>({
  user: null,
  setUser: () => {},
});

// ✅ Back-compat hook used across the app
export function useAuth() {
  return useContext(AuthContext);
}

// (Optional) Useful for tests or external wrappers
export function AuthProvider({
  children,
  initialUser = null,
}: {
  children: React.ReactNode;
  initialUser?: AuthUser;
}) {
  const [user, setUser] = useState<AuthUser>(initialUser);
  return (
    <AuthContext.Provider value={{ user, setUser }}>
      {children}
    </AuthContext.Provider>
  );
}

2) Re-export from client/src/App.tsx

So existing imports ({ useAuth } from "@/App") keep working:

// client/src/App.tsx
export { AuthContext, useAuth, AuthProvider } from "./auth-context"; // ⬅️ add this line

import React, { Suspense, lazy } from "react";
import { Route, Switch } from "wouter";
import AppShell from "./ui/AppShell";
import GlobalHotfixes from "./GlobalHotfixes";
import DevPageExplorer from "./DevPageExplorer";

// Adjust these to your actual pages (use the Dev Explorer list as source of truth)
const Home = lazy(() => import("./pages/about"));
const Profile = lazy(() => import("./pages/ProfilePageResponsive"));
const Chatroom = lazy(() => import("./pages/chatroom"));
const CityChatrooms = lazy(() => import("./pages/city-chatrooms"));
const NotFound = lazy(() => import("./pages/NotFound").catch(() => import("./DevPageExplorer")));

export default function App() {
  return (
    <AppShell>
      <GlobalHotfixes />
      <Suspense fallback={<div className="p-4">Loading…</div>}>
        <Switch>
          <Route path="/" component={Home} />
          <Route path="/profile/:id">{(p) => <Profile userId={Number(p.id)} />}</Route>
          <Route path="/chatroom" component={Chatroom} />
          <Route path="/chatrooms/:city" component={CityChatrooms as any} />
          <Route path="/__pages" component={DevPageExplorer} />
          <Route component={NotFound} />
        </Switch>
      </Suspense>
    </AppShell>
  );
}

3) Rebuild/run (prod = no WS)
cd client && npx vite build --mode production --sourcemap && cd ..
NODE_ENV=production node server/index.prod.js


That error will disappear because useAuth is now exported from @/App again (via re-export), while we keep the clean separation to avoid circular imports. If another “missing export from @/App” pops up (e.g., AuthProvider), it’s already covered by the re-exports above.