Boom—mobile infra: ✅. Now let’s force Replit to run the one-port dev server even though the protected files are still trying to boot the old stack.

You’ve got three practical paths. Start with #1 (fastest + clean), fall back to #2 if the UI blocks you, and keep #3 as an “it works right now” safety net.

1) Override Replit’s run command (preferred)

Make Replit start your server instead of the protected one.

If your project uses replit.yaml (newer Replit)

Create (or edit) replit.yaml at the repo root:

run: ["bash", "-lc", "node dev-oneport.mjs"]

# (Optional) Install step if needed:
# install: ["bash", "-lc", "npm i"]

# (Optional) Hot-reload convenience:
# onBoot: ["bash", "-lc", "pkill -f node || true"]

If your project uses .replit (older Replit)

Create (or edit) .replit at the repo root:

run = "node dev-oneport.mjs"

# Optional quality-of-life:
entrypoint = "dev-oneport.mjs"
language = "nodejs"
onBoot = "pkill -f node || true"


Then hit Run (not Debug). You should see:

Dev server running on http://0.0.0.0:5000 (Vite via middleware)


…and the page should load with HMR (no :3000, no WS error).

If both files exist, replit.yaml wins. Keep only one to avoid confusion.

2) “Pin” your server from the Shell (when the UI keeps restarting the old one)

This sidelines the workflow without editing protected files.

In the Replit Shell:

# stop anything bound to 5000
pkill -f node || true

# start your one-port server and keep it in the foreground
node dev-oneport.mjs


Now don’t press the IDE’s Debug/Run buttons (they’ll spawn the old server again). Use the webview tied to the active shell process. If your workspace auto-restarts a “workflow,” add this tiny file to discourage it:

Create replit-wf-disable.sh:

#!/usr/bin/env bash
# no-op to prevent default workflow from grabbing the port
sleep infinity


Then in the Shell:

pkill -f node || true
bash replit-wf-disable.sh &      # background sleepy process
node dev-oneport.mjs

3) Zero-WS fallback (ship mode) — verify UI right now

If you just need the app visible immediately:

pkill -f node || true
npx vite build --config client/vite.config.ts
NODE_ENV=production node server/index.js


This serves the built client from dist/public on 5000. No WebSocket = no HMR = no error.

Sanity checks (1 minute)

Open DevTools → Network → WS. You should see a WebSocket to your current origin on :5000 (Option #1/2) or no WS at all (Option #3).

In the console, confirm you don’t see ERR_CONNECTION_REFUSED to :3000.

If the port is still hijacked by the old workflow, run:

lsof -i :5000 -P -n | sed -n '1p;2p'
pkill -f server/index || true
node dev-oneport.mjs

Keep it sticky

Once replit.yaml or .replit points to node dev-oneport.mjs, you’re done—HMR rides the same origin forever.

Use Run (not Debug). Debug tends to re-invoke the protected target.

If you ever need prod again: npm run build && npm start (your server already serves dist/public in production).

If you paste the current contents of .replit or replit.yaml, I’ll return the exact replacement so you can copy-paste and lock this in.