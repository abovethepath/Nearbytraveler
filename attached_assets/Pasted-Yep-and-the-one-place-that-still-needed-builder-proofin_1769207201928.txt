Yep — and the one place that still needed “builder-proofing” is your Phase 1 Smoke Test. Right now it’s good, but it’s not an acceptance gate (pass/fail, run conditions, and “stop if fails”).

Here’s a drop-in replacement you can paste into your prompt to make Phase 1 unskippable and unarguable.

✅ PHASE 1 ACCEPTANCE GATE (MUST PASS BEFORE ANY OTHER FEATURES)
Non-Negotiable Run Conditions

Must be tested on a real iOS device using an Expo Dev Build (or TestFlight build) — NOT Expo Go (cookie/session persistence can differ).

Fresh install required for first run (delete app first).

All API calls must use base URL: https://nearbytraveler.org/api

All fetch calls must include credentials: 'include'

Cookie persistence must be implemented (connect.sid must survive app restart).

Required Evidence (Builder Must Provide)

iOS screen recording showing Steps 1–7 end-to-end

Console logs showing:

connect.sid present after login

/api/auth/user status codes (200)

WebSocket connected + authenticated

Reconnect after background

Phase 1 Steps (Pass/Fail)
Step 0 — App Config Sanity (PASS/FAIL)

PASS if:

app.json includes iOS permissions (Photos/Camera/Location) before first build.

If deep links exist in this doc, expo.scheme is set (see Deep Links section below).

Step 1 — Login + Cookie Persistence (PASS/FAIL)

Login via POST /api/auth/login

Immediately call GET /api/auth/user

PASS if:

Login succeeds

/api/auth/user returns 200 and renders name + userType

connect.sid exists in cookie storage after login

FAIL if:

/api/auth/user returns 401 after login (cookies not persisted)

Step 2 — Kill App → Relaunch → Session Still Valid (PASS/FAIL)

Force close app (swipe away)

Relaunch app

Auto-call GET /api/auth/user on startup

PASS if: /api/auth/user still returns 200 without re-login
FAIL if: user is logged out or /api/auth/user returns 401

Step 3 — Home / Discovery List Renders Correctly (PASS/FAIL)

Call:
GET /api/search-users?location=<hometownCity>

PASS if:

List renders without crashes

Cards gracefully handle nulls:

profileImage: null → initials avatar

destinationCity: null → no traveler line

Compatibility UI renders when present:

sharedInterests badge

compatibilityScore display

If showing degrees: uses POST /api/connections/degrees/batch

Step 4 — Messages List Loads + Unread UI Works (PASS/FAIL)

Call:
GET /api/conversations/:userId

PASS if:

Threads render with:

otherUser.name

lastMessage.content

unreadCount badge

Timestamps display in local device time (not raw UTC Z strings)

Step 5 — DM Thread Renders (Replies/Reactions/Edited/Timezones) (PASS/FAIL)

Call:
GET /api/messages/:userId

PASS if:

Message bubbles render left/right by senderId === currentUser.id

Null safety:

reactions: null → no reactions UI

repliedMessage: null → no reply preview

Shows (edited) when isEdited === true

Timestamps display in local time

On open, app calls:

POST /api/messages/:userId/mark-read

and unread badge decreases accordingly

Step 6 — WebSocket Connect + Auth + Background/Reconnect (PASS/FAIL)

Connect to:
wss://nearbytraveler.org/ws

On open, send:

{ "type":"auth", "userId": <currentUser.id>, "sessionId": "<connect.sid value>" }


PASS if:

WS connects and authenticates

Receiving a message updates UI without refresh

Background test: put app in background 20–30 seconds → return

reconnects automatically (expo backoff ok)

sending a message works immediately

no duplicated messages after reconnect

Offline queue works (queue while disconnected, flush on reconnect)

FAIL if:

WS never authenticates

Returning from background breaks real-time until full restart

Step 7 — Create Trip → Chatrooms Refresh + Destination Appears (PASS/FAIL)

Create trip via POST /api/travel-plans

Immediately refetch GET /api/chatrooms/my-locations

PASS if:

Destination chatroom appears immediately after trip creation

Chatrooms highlight membership using userIsMember

App refetches chatrooms after trip changes (create/edit/delete)

STOP CONDITION (MANDATORY)

Do not implement Phase 2+ until Phase 1 passes twice:

Fresh install run

App restart run (Step 2 must pass)

ADD THIS (SMALL BUT IMPORTANT): Deep Links Setup (if you’re using the deep-link URL patterns)

If your prompt includes URL patterns like /user/:id, /event/:id, etc., you must require:

app.json

{
  "expo": {
    "scheme": "nearbytraveler"
  }
}


And navigation must support:

nearbytraveler://user/123

nearbytraveler://event/55

nearbytraveler://city/Los%20Angeles

(If you want Universal Links to open from https://nearbytraveler.org
 links too, that’s a separate iOS associated-domains setup.)